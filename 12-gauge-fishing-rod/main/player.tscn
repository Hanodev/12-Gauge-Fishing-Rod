[gd_scene load_steps=32 format=3 uid="uid://cam4bh1ds81ys"]

[ext_resource type="Script" uid="uid://th58mqtf3yv3" path="res://main/player.gd" id="1_ou4ca"]
[ext_resource type="Script" uid="uid://doxjjxmpshdng" path="res://main/weaponry/essential/equipment_handler.gd" id="2_4v151"]
[ext_resource type="Script" uid="uid://cn5ac81pxi3am" path="res://asset/juice/shaker.gd" id="2_lat6o"]
[ext_resource type="Script" uid="uid://bmxbe0suv76bg" path="res://main/camera.gd" id="3_5ar6u"]
[ext_resource type="PackedScene" uid="uid://cvv5w7qvfkqsr" path="res://main/weaponry/gun/short_barrel.tscn" id="3_lat6o"]
[ext_resource type="Shader" uid="uid://cfhm3rsqlbmlq" path="res://asset/shader/canvas/anime_lines.gdshader" id="5_pi8k8"]
[ext_resource type="Script" uid="uid://dw0hnq7yosqa7" path="res://main/weaponry/essential/rod.gd" id="6_1vr6g"]
[ext_resource type="Shader" uid="uid://b5fa5uqmflay7" path="res://asset/shader/spatial/fire3d.gdshader" id="7_bsjl6"]
[ext_resource type="ArrayMesh" uid="uid://doun4bnrsfgcb" path="res://main/weaponry/gun/asset/Shotgun.obj" id="8_c6jii"]
[ext_resource type="AudioStream" uid="uid://def4qpstng24b" path="res://main/weaponry/gun/asset/ShotgunShot1.wav" id="9_47fst"]
[ext_resource type="AudioStream" uid="uid://bfvrlqo840cr2" path="res://main/weaponry/gun/asset/ShotgunShot2.wav" id="10_jsce1"]
[ext_resource type="AudioStream" uid="uid://cxb56fi7nxuwv" path="res://main/weaponry/gun/asset/ShotgunShot3.wav" id="11_xhk5t"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_oul6g"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_lat6o"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_3bycu"]
frequency = 0.0601
fractal_octaves = 1

[sub_resource type="FastNoiseLite" id="FastNoiseLite_lxgt3"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_vu6ih"]
noise = SubResource("FastNoiseLite_lxgt3")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_73nwk"]
render_priority = 0
shader = ExtResource("7_bsjl6")
shader_parameter/noise_tex = SubResource("NoiseTexture2D_vu6ih")
shader_parameter/root_color = Color(1, 0.75, 0.3, 1)
shader_parameter/tip_color = Color(1, 0.03, 0.001, 1)
shader_parameter/fire_alpha = 1.0
shader_parameter/fire_speed = Vector2(0, 1)
shader_parameter/fire_aperture = 0.22

[sub_resource type="CylinderMesh" id="CylinderMesh_o4ts1"]
top_radius = 0.12
bottom_radius = 0.12
height = 1.0
radial_segments = 8
rings = 0
cap_top = false
cap_bottom = false

[sub_resource type="FastNoiseLite" id="FastNoiseLite_o4ts1"]
noise_type = 2
frequency = 0.0125
fractal_octaves = 10

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_lxgt3"]
noise = SubResource("FastNoiseLite_o4ts1")
seamless = true
in_3d_space = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vu6ih"]
render_priority = 0
shader = ExtResource("7_bsjl6")
shader_parameter/noise_tex = SubResource("NoiseTexture2D_lxgt3")
shader_parameter/root_color = Color(1, 1, 0, 1)
shader_parameter/tip_color = Color(1, 0, 0, 1)
shader_parameter/fire_alpha = 1.0
shader_parameter/fire_speed = Vector2(0, 0.05)
shader_parameter/fire_aperture = 3.0

[sub_resource type="FastNoiseLite" id="FastNoiseLite_vu6ih"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_73nwk"]
noise = SubResource("FastNoiseLite_vu6ih")
seamless = true
in_3d_space = true

[sub_resource type="Animation" id="Animation_3bycu"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Shaker/MeshInstance3D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0.41311347, -0.41280866, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Shaker/MeshInstance3D:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 0, 0)]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Shaker")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(),
"transitions": PackedFloat32Array(),
"values": []
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Shaker/MeshInstance3D/MeshInstance3D:surface_material_override/0:shader_parameter/fire_aperture")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [3.0]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("Shaker/MeshInstance3D/SpotLight3D:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Shaker/MeshInstance3D/SpotLight3D:spot_attenuation")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [-2.41]
}

[sub_resource type="Animation" id="Animation_8qhk2"]
resource_name = "shoot"
length = 0.3
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Shaker/MeshInstance3D:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.033333335, 0.06666667, 0.17602974, 0.2, 0.26666668),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.413, -0.413, -0.77), Vector3(0.413, -0.413, 1.415), Vector3(0.41311347, -0.41280866, 0), Vector3(0.413, -0.463, 0), Vector3(0.41311347, -0.41280866, 0), Vector3(0.413, -0.413, -0.77)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Shaker/MeshInstance3D:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.099999994, 0.13333334, 0.1875231, 0.21655892),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 0, 0), Vector3(0.07853982, 0.08726646, -0.061086524), Vector3(0, 0, 0), Vector3(-0.1308997, 0, 0), Vector3(0, 0, 0)]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Shaker")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.033333335, 0.06666667),
"transitions": PackedFloat32Array(1, 1, 1),
"values": [{
"args": [],
"method": &"apply_fov_change"
}, {
"args": [0.8],
"method": &"add_trauma"
}, {
"args": [],
"method": &"apply_camera_shake"
}]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Shaker/MeshInstance3D/MeshInstance3D:surface_material_override/0:shader_parameter/fire_aperture")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0.06666667, 0.16666667, 0.3),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [0.0, 0.0, 3.0]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("Shaker/MeshInstance3D/SpotLight3D:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0.033333335, 0.26666668),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Shaker/MeshInstance3D/SpotLight3D:spot_attenuation")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0.033333335, 0.13333334),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [-2.41, 0.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_3bycu"]
_data = {
&"RESET": SubResource("Animation_3bycu"),
&"shoot": SubResource("Animation_8qhk2")
}

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_vu6ih"]
streams_count = 3
stream_0/stream = ExtResource("9_47fst")
stream_1/stream = ExtResource("10_jsce1")
stream_2/stream = ExtResource("11_xhk5t")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_pi8k8"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_5ar6u"]
noise = SubResource("FastNoiseLite_pi8k8")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_5ar6u"]
shader = ExtResource("5_pi8k8")
shader_parameter/noise = SubResource("NoiseTexture2D_5ar6u")
shader_parameter/line_count = 2.0
shader_parameter/distortion_power = 0.034
shader_parameter/line_falloff = 0.386000018335
shader_parameter/mask_size = 0.175
shader_parameter/mask_edge = 0.195
shader_parameter/animation_speed = 20.0
shader_parameter/blur_strength = 0.01
shader_parameter/effect_power = 1.0

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("rod")]
script = ExtResource("1_ou4ca")
rod = NodePath("CameraPivot/CameraHolder/EquipmentHandler/TestRod")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_oul6g")

[node name="CameraPivot" type="Node3D" parent="."]
script = ExtResource("2_lat6o")
camera_shake = true
noise = SubResource("FastNoiseLite_lat6o")
noise_speed = 80.0
max_x = 15.0
metadata/_custom_type_script = "uid://cn5ac81pxi3am"

[node name="CameraHolder" type="Node3D" parent="CameraPivot"]

[node name="Camera3D" type="Camera3D" parent="CameraPivot/CameraHolder"]
unique_name_in_owner = true
script = ExtResource("3_5ar6u")

[node name="EquipmentHandler" type="Node3D" parent="CameraPivot/CameraHolder" node_paths=PackedStringArray("main_equipment")]
script = ExtResource("2_4v151")
main_equipment = NodePath("TestRod")
metadata/_custom_type_script = "uid://doxjjxmpshdng"

[node name="ShortBarrel" parent="CameraPivot/CameraHolder/EquipmentHandler" instance=ExtResource("3_lat6o")]

[node name="TestRod" type="Node3D" parent="CameraPivot/CameraHolder/EquipmentHandler"]
script = ExtResource("6_1vr6g")
metadata/_custom_type_script = "uid://chtdxnjbpm3m3"

[node name="Shaker" type="Node3D" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod"]
script = ExtResource("2_lat6o")
trauma_reduction_rate = 2.0
noise = SubResource("FastNoiseLite_3bycu")
noise_speed = 15.0
max_x = 15.0
max_y = 15.0
max_z = 0.0
traumua_target = 0.4
metadata/_custom_type_script = "uid://cn5ac81pxi3am"

[node name="MeshInstance3D" type="MeshInstance3D" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod/Shaker"]
transform = Transform3D(0.25, 0, 0, 0, 0.25, 0, 0, 0, 0.25, 0.41311347, -0.41280866, 0)
material_overlay = SubResource("ShaderMaterial_73nwk")
mesh = ExtResource("8_c6jii")
skeleton = NodePath("../..")

[node name="MeshInstance3D" type="MeshInstance3D" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod/Shaker/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0.37502897, -6.612996)
mesh = SubResource("CylinderMesh_o4ts1")
surface_material_override/0 = SubResource("ShaderMaterial_vu6ih")

[node name="SpotLight3D" type="SpotLight3D" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod/Shaker/MeshInstance3D"]
transform = Transform3D(4, 0, 0, 0, 4, 0, 0, 0, 4, -0.041856766, 0.10152626, -3.3689284)
visible = false
light_color = Color(1, 1, 0, 1)
light_projector = SubResource("NoiseTexture2D_73nwk")
shadow_enabled = true
spot_range = 23.67
spot_attenuation = -2.41
spot_angle_attenuation = 0.066985846

[node name="AnimationPlayer" type="AnimationPlayer" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod"]
libraries = {
&"": SubResource("AnimationLibrary_3bycu")
}

[node name="SFXFire" type="AudioStreamPlayer" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod"]
stream = SubResource("AudioStreamRandomizer_vu6ih")
bus = &"Effects"

[node name="target" type="Node3D" parent="CameraPivot/CameraHolder/EquipmentHandler/TestRod"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.1909585, -2.8715885)

[node name="CanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="ColorRect" type="ColorRect" parent="CanvasLayer"]
material = SubResource("ShaderMaterial_5ar6u")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[connection signal="primary_activated" from="CameraPivot/CameraHolder/EquipmentHandler/TestRod" to="CameraPivot/CameraHolder/EquipmentHandler/TestRod/SFXFire" method="play"]
[connection signal="primary_activated" from="CameraPivot/CameraHolder/EquipmentHandler/TestRod" to="CameraPivot/CameraHolder/EquipmentHandler/TestRod/AnimationPlayer" method="play" binds= [&"shoot"]]
